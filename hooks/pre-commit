#!/bin/bash

PATTERNS=(
    "sk-[a-zA-Z0-9]{24,}"                       # Generic OpenAI-style keys
    "sk-proj-[a-zA-Z0-9]{24,}"                  # Stripe-style keys
    "pk-[a-zA-Z0-9]{24,}"                       # Public keys
    "rk-[a-zA-Z0-9]{24,}"                       # Restricted keys
    "ak-[a-zA-Z0-9]{24,}"                       # Access keys
    "api[_-]?key[_-]?[a-zA-Z0-9]{24,}"          # Generic API key format
    "secret[_-]?key[_-]?[a-zA-Z0-9]{24,}"       # Secret key format
    "bearer[_-]?token[_-]?[a-zA-Z0-9]{24,}"     # Bearer token format
)

STAGED_FILES=$(git diff --cached --name-only)

for FILE in $STAGED_FILES; do
    for PATTERN in "${PATTERNS[@]}"; do
        if grep -qE "$PATTERN" "$FILE"; then
            echo "Error: Potential API key detected in file: $FILE"
            echo "Please remove the API key before committing."
            exit 1
        fi
    done
done

exit 0 